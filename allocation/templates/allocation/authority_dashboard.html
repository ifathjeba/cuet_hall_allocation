{% extends 'allocation/base.html' %}
{% load static %}

{% block title %}Authority Dashboard - NestMate CUET{% endblock %}

{% block content %}
<div class="container-fluid py-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Welcome, Authority</h2>
        <div class="d-flex align-items-center">
            <img src="{% static 'img/23.jpg' %}" alt="Profile" class="rounded-circle me-2" width="50" height="50">
            <a href="#" class="btn btn-danger btn-sm">Logout</a>
        </div>
    </div>

    <!-- Dashboard Stats -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card text-center shadow-sm p-3">
                <i class="fa-solid fa-user-graduate fa-2x mb-2 text-primary"></i>
                <h5>Total Students</h5>
                <p class="h4">1200</p>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card text-center shadow-sm p-3">
                <i class="fa-solid fa-check fa-2x mb-2 text-success"></i>
                <h5>Approved</h5>
                <p class="h4">9</p>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card text-center shadow-sm p-3">
                <i class="fa-solid fa-xmark fa-2x mb-2 text-danger"></i>
                <h5>Rejected</h5>
                <p class="h4">6</p>
            </div>
        </div>
    </div>

    <!-- Recent Student Activities -->
    <div class="card mb-4">
        <div class="card-header bg-secondary text-white">
            Recent Student Activities
        </div>
        <div class="card-body table-responsive">
            <table class="table table-striped mb-0">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Action</th>
                        <th>Hall</th>
                        <th>Date/Time</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><img src="{% static 'img/25.jpg' %}" width="30" class="rounded-circle me-1"> Ayesha Samin</td>
                        <td>Applied for Standard Room (4 People)</td>
                        <td>Shamshen Nahar Hall</td>
                        <td>12 Nov 2025 14:30</td>
                    </tr>
                    <tr>
                        <td><img src="{% static 'img/23.jpg' %}" width="30" class="rounded-circle me-1"> Maimuna Tabassum</td>
                        <td>Application Approved</td>
                        <td>Shamshen Nahar Hall</td>
                        <td>14 Nov 2025 16:45</td>
                    </tr>
                    <tr>
                        <td><img src="{% static 'img/8.jpg' %}" width="30" class="rounded-circle me-1"> Abunti Barua</td>
                        <td>Applied for Standard Room (4 People)</td>
                        <td>Shamshen Nahar Hall</td>
                        <td>13 Nov 2025 09:20</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Hall Occupancy Overview -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card shadow-sm p-3 text-center">
                <img src="{% static 'img/20.jpg' %}" alt="Hall A" class="img-fluid mb-2 rounded">
                <h6>Shamshen Nahar Hall</h6>
                <p>620 / 650 Students</p>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card shadow-sm p-3 text-center">
                <img src="{% static 'img/19.jpg' %}" alt="Hall B" class="img-fluid mb-2 rounded">
                <h6>Tapashi Rabeya Hall</h6>
                <p>310 / 380 Students</p>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card shadow-sm p-3 text-center">
                <img src="{% static 'img/26.jpg' %}" alt="Hall C" class="img-fluid mb-2 rounded">
                <h6>Sufia Kamal Hall</h6>
                <p>270 / 300 Students</p>
            </div>
        </div>
    </div>

    <!-- Pending Room Applications Table -->
    <div class="card mb-5">
        <div class="card-header bg-primary text-white">
            Pending Room Applications
        </div>
        <div class="card-body table-responsive">
            {% if applications %}
            <table class="table table-hover align-middle mb-0">
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Year</th>
                        <th>CGPA</th>
                        <th>Room Type</th>
                        <th>Room Number</th>
                        <th>Special Request</th>
                        <th>Applied At</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for app in applications %}
                    <tr>
                        <td>{{ app.email }}</td>
                        <td>{{ app.year }}</td>
                        <td>{{ app.cgpa }}</td>
                        <td>{{ app.room_type }}</td>
                        <td>{{ app.room_number }}</td>
                        <td>{{ app.special_request }}</td>
                        <td>{{ app.applied_at|date:"d M Y H:i" }}</td>
                        <td>
                            <a href="{% url 'approve_application' app.id %}" class="btn btn-success btn-sm">Approve</a>
                            <a href="{% url 'reject_application' app.id %}" class="btn btn-danger btn-sm">Reject</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
                <p class="text-center my-3">No pending applications at the moment.</p>
            {% endif %}
        </div>
    </div>

</div>
{% endblock %}
